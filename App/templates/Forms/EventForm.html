!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CariFin Data Dashboard ‚Äì Event Management</title>
<link rel="stylesheet" href="Style.css">
<style>
  /* ‚îÄ‚îÄ PAGE-SPECIFIC STYLES ‚îÄ‚îÄ */
  .stage-table input[type="text"],
  .stage-table input[type="date"] {
    width: 100%;
    font-size: 11px;
    padding: 3px 7px;
  }
  .stage-table input[type="date"] { width: auto; min-width: 130px; }

  textarea {
    border: 1.5px solid var(--border);
    background: var(--bg);
    padding: 7px 10px;
    font-family: 'IBM Plex Sans', sans-serif;
    font-size: 12px;
    color: var(--text);
    outline: none;
    resize: vertical;
    width: 100%;
    max-width: 420px;
    min-height: 70px;
    transition: border-color 0.15s;
  }
  textarea:focus { border-color: var(--accent); }

  .form-row.top-align { align-items: flex-start; }
  .form-row.top-align .form-label { margin-top: 6px; }

  .stage-table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
  .stage-table th {
    font-size: 10px; padding: 6px 10px; background: #f0ece4;
  }
  .stage-table td { padding: 6px 8px; font-size: 12px; }
  .stage-table td:first-child { text-align: center; font-family: 'IBM Plex Mono', monospace; font-weight: 600; width: 48px; }

  .stage-actions { display: flex; gap: 6px; margin-bottom: 16px; }

  /* Description cell truncation in main table */
  .desc-cell { max-width: 180px; font-size: 11px; color: var(--text-muted); line-height: 1.4; }
</style>
</head>
<body>

<!-- TOP BAR -->
<div class="topbar">
  <span>CariFin Data Dashboard</span>
  <div class="topbar-right">
    <span>Hi, Admin123 (Admin)</span>
    <a href="#">System ‚ñæ</a>
    <a href="#">Logout</a>
  </div>
</div>

<!-- PAGE HEADER -->
<div class="page-header">
  <div class="logo-box">üèî</div>
  <div class="breadcrumb"><span>System &rsaquo;</span> Event Management</div>
</div>

<!-- MAIN -->
<div class="main">

  <div class="section-title">Manage Events</div>

  <!-- ACTIVE EVENTS TABLE -->
  <div class="card">
    <div class="card-header">Active Events</div>
    <table>
      <thead>
        <tr>
          <th>ID#</th>
          <th>Event Name</th>
          <th>Type</th>
          <th>Stages</th>
          <th>Description</th>
          <th>Status</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="eventsTableBody">
        <!-- Rendered by JS -->
      </tbody>
    </table>
  </div>

  <!-- ADD NEW EVENT button -->
  <div class="section-actions" style="text-align:left; margin-bottom: 20px;">
    <button class="btn" onclick="openForm('new')">+ Add New Event</button>
  </div>

  <!-- ADD/EDIT EVENT FORM -->
  <div class="form-panel" id="eventForm">
    <div class="form-panel-header">
      <span id="formTitle">Add / Edit Event Form</span>
      <button class="close-btn" onclick="closeForm()" title="Close">‚úï</button>
    </div>
    <div class="form-body">

      <!-- Event Name -->
      <div class="form-row">
        <span class="form-label">Event Name:</span>
        <input type="text" class="wide" id="eventName" placeholder="e.g. Urban Challenge">
      </div>

      <!-- Event Type -->
      <div class="form-row">
        <span class="form-label">Event Type:</span>
        <div class="radio-group">
          <label class="radio-option"><input type="radio" name="eventType" value="Run"> Run</label>
          <label class="radio-option"><input type="radio" name="eventType" value="Walk" checked> Walk</label>
          <label class="radio-option"><input type="radio" name="eventType" value="Mixed"> Mixed</label>
          <label class="radio-option"><input type="radio" name="eventType" value="Other"> Other</label>
        </div>
      </div>

      <!-- Description -->
      <div class="form-row top-align">
        <span class="form-label">Description:</span>
        <textarea id="eventDescription" placeholder="Brief description of the event‚Ä¶"></textarea>
      </div>

      <!-- Stage Configuration -->
      <div class="events-label" style="margin-top: 6px;">Stage Configuration</div>
      <table class="stage-table">
        <thead>
          <tr>
            <th>Stage</th>
            <th>Distance</th>
            <th>Location</th>
            <th>Date</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="stageTableBody">
          <!-- Rendered by JS -->
        </tbody>
      </table>

      <div class="stage-actions">
        <button class="btn btn-ghost btn-sm" onclick="addStage()">Add Stage</button>
        <button class="btn btn-ghost btn-sm" onclick="removeStage()">Remove Stage</button>
      </div>

    </div><!-- /form-body -->

    <!-- FORM ACTIONS -->
    <div class="form-actions">
      <button class="btn" onclick="handleSave()">Save Event</button>
      <button class="btn btn-ghost" onclick="closeForm()">Cancel</button>
      <button class="btn btn-danger" id="deleteBtn" onclick="handleDelete()" style="margin-left:auto; display:none;">Delete Event</button>
    </div>
  </div>

</div><!-- /main -->

<!-- CONFIRM MODAL (Archive / Delete) -->
<div class="overlay" id="confirmOverlay">
  <div class="modal">
    <h3 id="confirmTitle">Confirm Action</h3>
    <p id="confirmMsg">Are you sure?</p>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeConfirm()">Cancel</button>
      <button class="btn" id="confirmOkBtn" onclick="confirmAction()">Confirm</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
  /* ‚îÄ‚îÄ DATA STORE ‚îÄ‚îÄ */
  let events = [
    { id: 1, name: 'Urban Challenge', type: 'Run',  stages: 3, description: 'Multi-stage running challenge across 3 different locations.', status: 'active',   stages_data: [{distance:'5K', location:"Queen's Park", date:'2025-02-15'},{distance:'5K',location:'Brian Lara',date:'2025-02-22'},{distance:'3K',location:'Hasely Cro.',date:'2025-03-05'}] },
    { id: 2, name: 'Cross Country',   type: 'Run',  stages: 1, description: '',                                                              status: 'active',   stages_data: [{distance:'10K',location:'Arima',date:'2025-03-10'}] },
    { id: 3, name: 'Urban Walk',      type: 'Walk', stages: 3, description: '',                                                              status: 'inactive', stages_data: [{distance:'3K',location:'POS',date:'2025-04-01'},{distance:'3K',location:'San Fernando',date:'2025-04-08'},{distance:'3K',location:'Chaguanas',date:'2025-04-15'}] },
  ];
  let nextId = 4;
  let currentMode = 'new';
  let editingId   = null;
  let pendingAction = null;

  /* ‚îÄ‚îÄ RENDER MAIN TABLE ‚îÄ‚îÄ */
  function renderTable() {
    const tbody = document.getElementById('eventsTableBody');
    if (!events.length) {
      tbody.innerHTML = `<tr><td colspan="7" style="text-align:center;color:var(--text-muted);padding:20px;">No events found.</td></tr>`;
      return;
    }
    tbody.innerHTML = events.map(e => {
      const isActive = e.status === 'active';
      const statusBadge = isActive
        ? `<span class="status-dot dot-active"></span> Active`
        : `<span class="status-dot dot-closed"></span> Inactive`;
      const actions = isActive
        ? `<button class="btn btn-sm" onclick="openForm('edit',${e.id})">Edit</button>
           <button class="btn btn-sm btn-ghost" onclick="triggerArchive(${e.id})">Archive</button>`
        : `<button class="btn btn-sm btn-ghost" onclick="triggerActivate(${e.id})">Activate</button>
           <button class="btn btn-sm btn-danger" onclick="triggerDelete(${e.id})">Delete</button>`;
      return `
        <tr>
          <td style="font-family:'IBM Plex Mono',monospace;font-weight:600;text-align:center;">${e.id}</td>
          <td><strong>${e.name}</strong></td>
          <td>${e.type}</td>
          <td style="text-align:center;">${e.stages_data.length}</td>
          <td class="desc-cell">${e.description || '‚Äî'}</td>
          <td>${statusBadge}</td>
          <td style="white-space:nowrap;">${actions}</td>
        </tr>`;
    }).join('');
  }

  /* ‚îÄ‚îÄ STAGE ROWS ‚îÄ‚îÄ */
  function renderStages(stages_data) {
    const tbody = document.getElementById('stageTableBody');
    tbody.innerHTML = '';
    (stages_data || []).forEach((s, i) => addStageRow(i + 1, s));
  }

  function addStageRow(num, data = {}) {
    const tbody = document.getElementById('stageTableBody');
    const rowNum = num || tbody.rows.length + 1;
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${rowNum}</td>
      <td><input type="text" placeholder="e.g. 5K" value="${data.distance || ''}"></td>
      <td><input type="text" placeholder="Location" value="${data.location || ''}"></td>
      <td><input type="date" value="${data.date || ''}"></td>
      <td><button class="btn btn-sm btn-ghost" onclick="this.closest('tr').remove(); renumberStages();" title="Remove row">‚úï</button></td>`;
    tbody.appendChild(tr);
  }

  function addStage() {
    const tbody = document.getElementById('stageTableBody');
    addStageRow(tbody.rows.length + 1);
  }

  function removeStage() {
    const tbody = document.getElementById('stageTableBody');
    if (tbody.rows.length > 0) tbody.deleteRow(tbody.rows.length - 1);
  }

  function renumberStages() {
    const rows = document.querySelectorAll('#stageTableBody tr');
    rows.forEach((r, i) => r.cells[0].textContent = i + 1);
  }

  function getStagesFromTable() {
    const rows = document.querySelectorAll('#stageTableBody tr');
    return Array.from(rows).map(r => ({
      distance: r.cells[1].querySelector('input').value.trim(),
      location: r.cells[2].querySelector('input').value.trim(),
      date:     r.cells[3].querySelector('input').value,
    }));
  }

  /* ‚îÄ‚îÄ OPEN / CLOSE FORM ‚îÄ‚îÄ */
  function openForm(mode, id) {
    currentMode = mode;
    editingId = id || null;

    // Reset
    document.getElementById('eventName').value = '';
    document.getElementById('eventDescription').value = '';
    document.querySelectorAll('input[name="eventType"]')[1].checked = true;
    document.getElementById('stageTableBody').innerHTML = '';
    document.getElementById('deleteBtn').style.display = 'none';

    if (mode === 'new') {
      document.getElementById('formTitle').textContent = 'Add New Event';
      addStageRow(1);
    } else {
      const ev = events.find(e => e.id === id);
      if (!ev) return;
      document.getElementById('formTitle').textContent = `Edit Event ‚Äì ${ev.name}`;
      document.getElementById('eventName').value = ev.name;
      document.getElementById('eventDescription').value = ev.description;
      document.querySelectorAll('input[name="eventType"]').forEach(r => r.checked = r.value === ev.type);
      renderStages(ev.stages_data);
      document.getElementById('deleteBtn').style.display = 'inline-block';
    }

    document.getElementById('eventForm').classList.add('active');
    setTimeout(() => document.getElementById('eventForm').scrollIntoView({ behavior: 'smooth', block: 'start' }), 50);
  }

  function closeForm() {
    document.getElementById('eventForm').classList.remove('active');
    editingId = null;
  }

  /* ‚îÄ‚îÄ SAVE ‚îÄ‚îÄ */
  function handleSave() {
    const name = document.getElementById('eventName').value.trim();
    if (!name) { showToast('‚ö† Please enter an Event Name.'); return; }

    const type        = document.querySelector('input[name="eventType"]:checked')?.value || 'Walk';
    const description = document.getElementById('eventDescription').value.trim();
    const stages_data = getStagesFromTable();

    if (currentMode === 'new') {
      events.push({ id: nextId++, name, type, description, status: 'active', stages_data });
      showToast(`‚úì Event "${name}" added successfully.`);
    } else {
      const idx = events.findIndex(e => e.id === editingId);
      if (idx > -1) {
        events[idx] = { ...events[idx], name, type, description, stages_data };
        showToast(`‚úì Event "${name}" updated successfully.`);
      }
    }

    renderTable();
    closeForm();
  }

  /* ‚îÄ‚îÄ ARCHIVE ‚îÄ‚îÄ */
  function triggerArchive(id) {
    const ev = events.find(e => e.id === id);
    pendingAction = () => {
      ev.status = 'inactive';
      renderTable();
      showToast(`‚úì "${ev.name}" archived.`);
    };
    openConfirm('Archive Event', `Archive "${ev.name}"? It will be marked inactive.`);
  }

  /* ‚îÄ‚îÄ ACTIVATE ‚îÄ‚îÄ */
  function triggerActivate(id) {
    const ev = events.find(e => e.id === id);
    ev.status = 'active';
    renderTable();
    showToast(`‚úì "${ev.name}" is now Active.`);
  }

  /* ‚îÄ‚îÄ DELETE ‚îÄ‚îÄ */
  function triggerDelete(id) {
    const ev = events.find(e => e.id === id);
    pendingAction = () => {
      events = events.filter(e => e.id !== id);
      renderTable();
      showToast(`‚úì "${ev.name}" deleted.`);
    };
    openConfirm('Delete Event', `Permanently delete "${ev.name}"? This cannot be undone.`, true);
  }

  function handleDelete() {
    if (!editingId) return;
    const ev = events.find(e => e.id === editingId);
    pendingAction = () => {
      events = events.filter(e => e.id !== editingId);
      renderTable();
      closeForm();
      showToast(`‚úì "${ev.name}" deleted.`);
    };
    openConfirm('Delete Event', `Permanently delete "${ev.name}"? This cannot be undone.`, true);
  }

  /* ‚îÄ‚îÄ CONFIRM MODAL ‚îÄ‚îÄ */
  function openConfirm(title, msg, danger = false) {
    document.getElementById('confirmTitle').textContent = title;
    document.getElementById('confirmMsg').textContent = msg;
    const btn = document.getElementById('confirmOkBtn');
    btn.className = danger ? 'btn btn-danger' : 'btn';
    btn.textContent = danger ? 'Delete' : 'Confirm';
    document.getElementById('confirmOverlay').classList.add('active');
  }
  function closeConfirm() {
    document.getElementById('confirmOverlay').classList.remove('active');
    pendingAction = null;
  }
  function confirmAction() {
    if (pendingAction) pendingAction();
    closeConfirm();
  }

  /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
  function showToast(msg) {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.classList.add('show');
    clearTimeout(t._timer);
    t._timer = setTimeout(() => t.classList.remove('show'), 3200);
  }

  // Initial render
  renderTable();
</script>
</body>
</html>